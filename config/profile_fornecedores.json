{
  "profile_name": "fornecedores_csv",
  "version": "1.0",
  "source_kind": "csv",
  "dialect": {
    "encoding_default": "utf-8-sig",
    "encoding_candidates": [
      "utf-8-sig",
      "latin1",
      "cp1252"
    ],
    "delimiter_default": ";",
    "delimiter_candidates": [
      ";",
      ",",
      "\t",
      "|"
    ],
    "quotechar": "\"",
    "has_header": true
  },
  "canonical_columns": [
    "codigo",
    "nome",
    "cnpj",
    "tipo",
    "situacao"
  ],
  "rename_rules": [
    {
      "pattern": "(?i)^(c[oó]d(igo)?|cod|id)$",
      "to": "codigo"
    },
    {
      "pattern": "(?i)^(raza[óo] social|nome(_fantasia)?|fornecedor|cliente)$",
      "to": "nome"
    },
    {
      "pattern": "(?i)^(cnpj(_cpf)?|cpf(_cnpj)?|doc(umento)?)$",
      "to": "cnpj"
    },
    {
      "pattern": "(?i)^(tipo|categoria|classe)$",
      "to": "tipo"
    },
    {
      "pattern": "(?i)^situa(c|ç)[aã]o$",
      "to": "situacao"
    }
  ],
  "parse_rules": {
    "id": {
      "input_field": "codigo",
      "normalize": {
        "strip": true,
        "upper": true
      }
    },
    "name": {
      "input_field": "nome",
      "normalize": {
        "strip": true,
        "upper": true,
        "remove_accents": true,
        "collapse_spaces": true
      }
    },
    "cnpj": {
      "input_field": "cnpj",
      "outputs": {
        "cnpj_digits": {
          "regex_keep_digits": true
        }
      },
      "format_out": {
        "mask": "##.###.###/####-##",
        "apply_if_len": 14
      }
    },
    "tipo": {
      "input_field": "tipo",
      "normalize_map": {
        "fornecedor": "FORNECEDOR",
        "cliente": "CLIENTE",
        "ambos": "AMBOS"
      },
      "uppercase": true,
      "default": "FORNECEDOR"
    },
    "situacao": {
      "input_field": "situacao",
      "normalize_map": {
        "ativo": "ATIVO",
        "inativo": "INATIVO",
        "bloqueado": "BLOQUEADO"
      },
      "uppercase": true
    }
  },
  "validators": {
    "required_columns": [
      "codigo",
      "nome"
    ],
    "rules": [
      {
        "name": "cnpj_len_valid",
        "expr": "cnpj_digits IS NULL OR length(cnpj_digits) IN (11,14)"
      },
      {
        "name": "codigo_not_empty",
        "expr": "length(codigo) >= 1"
      }
    ]
  },
  "output_mapping_to_staging": {
    "table": "stg_fornecedores",
    "columns": {
      "codigo": "codigo",
      "nome": "nome",
      "cnpj": "cnpj_digits",
      "tipo": "tipo",
      "raw_json": "raw_json"
    }
  },
  "profiling": {
    "sample_rows": 200,
    "null_like_values": [
      "",
      "NULL",
      "N/A",
      "-",
      "--"
    ],
    "warn_on_unknown_columns": true
  },
  "test_samples": [
    {
      "input": {
        "Código": "000045",
        "Razão Social": "Oxigênio Modelo Indústria e Comércio de Gases LTDA",
        "CNPJ_CPF": "04.502.123/0001-89",
        "Tipo": "Fornecedor",
        "Situação": "Ativo"
      },
      "expected_after_parse": {
        "codigo": "000045",
        "nome": "OXIGENIO MODELO INDUSTRIA E COMERCIO DE GASES LTDA",
        "cnpj_digits": "04502123000189",
        "tipo": "FORNECEDOR",
        "situacao": "ATIVO"
      }
    }
  ]
}